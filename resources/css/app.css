@import "tailwindcss";

@source '../../vendor/laravel/framework/src/Illuminate/Pagination/resources/views/*.blade.php';
@source '../../storage/framework/views/*.php';

@theme inline {
  --font-sans:
    Instrument Sans, ui-sans-serif, system-ui, sans-serif, "Apple Color Emoji",
    "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";
}

@custom-variant dark (&:where(.dark, .dark *));

/**
 * Modern Reboot + Normalize
 * Target: Chrome Canary / Blink Only
 * Features: @layer, light-dark(), color-mix(), field-sizing, interpolate-size, text-box-trim
 */

@layer reset, base, typography, forms, components;

/* =================================================================
   GLOBAL PROPERTIES
   ================================================================= */
:root {
  /* Automatic dark mode with light-dark() - Chrome 123+ */
  --color-bg: light-dark(#ffffff, #0a0a0a);
  --color-surface: light-dark(#f8f9fa, #171717);
  --color-fg: light-dark(#0f0f0f, #f0f0f0);
  --color-muted: light-dark(#6c757d, #a1a1aa);
  --color-border: light-dark(#e5e5e5, #27272a);
  --color-accent: #0d6efd;

  /* Typography */
  --font-sans:
    system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
  --font-mono:
    ui-monospace, SFMono-Regular, Menlo, Monaco, "Cascadia Mono", monospace;

  /* Spacing using logical properties concepts */
  --space-xs: 0.5rem;
  --space-sm: 0.75rem;
  --space-md: 1rem;
  --space-lg: 1.5rem;
  --space-xl: 3rem;

  /* Enable keyword interpolation for height/width transitions - Chrome 129+ */
  interpolate-size: allow-keywords;

  /* Enable color scheme for native form controls */
  color-scheme: light dark;

  /* Scrollbar styling */
  scrollbar-width: thin;
  scrollbar-color: var(--color-muted) transparent;
}

/* =================================================================
   LAYER: RESET (Zero specificity using :where())
   ================================================================= */
@layer reset {
  :where(*, *::before, *::after) {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
    border: 0 solid var(--color-border);
  }

  :where(html) {
    line-height: 1.15;
    text-size-adjust: 100%;
    container-type: inline-size; /* Enable cqi units */
  }

  :where(body) {
    min-block-size: 100dvb; /* Dynamic viewport block units */
    font-synthesis: none; /* Prevent fake bold/italic */
    text-rendering: optimizeLegibility;
  }

  :where(img, picture, video, canvas, svg, iframe) {
    display: block;
    max-inline-size: 100%;
    block-size: auto;
  }

  :where(input, button, textarea, select) {
    font: inherit;
    color: inherit;
    line-height: inherit;
  }

  :where(button, [type="button"], [type="reset"], [type="submit"]) {
    cursor: pointer;
    background: transparent;
    -webkit-appearance: none;
    appearance: none;
  }

  :where(ul[role="list"], ol[role="list"]) {
    list-style: none;
  }

  :where(textarea) {
    resize: block; /* Logical resize direction */
  }

  /* Remove default details marker in Blink */
  ::-webkit-details-marker {
    display: none;
  }
}

/* =================================================================
   LAYER: BASE
   ================================================================= */
@layer base {
  body {
    font-family: var(--font-sans);
    font-size: 1rem;
    line-height: 1.6;
    color: var(--color-fg);
    background-color: var(--color-bg);
    accent-color: var(--color-accent); /* Native form coloring */
    caret-color: var(--color-accent);
    touch-action: manipulation;
  }

  /* Selection using color-mix for alpha - modern replacement of RGBA variables */
  ::selection {
    background-color: color-mix(in srgb, var(--color-accent) 30%, transparent);
    color: inherit;
  }

  :focus-visible {
    outline: 2px solid var(--color-accent);
    outline-offset: 2px;
    border-radius: 0.25rem;
  }

  /* Smooth scrolling preference */
  @media (prefers-reduced-motion: no-preference) {
    html {
      scroll-behavior: smooth;
    }
  }
}

/* =================================================================
   LAYER: TYPOGRAPHY (Fluid sizing with cqi units)
   ================================================================= */
@layer typography {
  :where(h1) {
    font-size: clamp(1.75rem, 5cqi, 3rem);
  }
  :where(h2) {
    font-size: clamp(1.5rem, 4cqi, 2.25rem);
  }
  :where(h3) {
    font-size: clamp(1.25rem, 3cqi, 1.875rem);
  }
  :where(h4) {
    font-size: clamp(1.125rem, 2cqi, 1.5rem);
  }
  :where(h5) {
    font-size: 1.25rem;
  }
  :where(h6) {
    font-size: 1rem;
  }

  :where(h1, h2, h3, h4, h5, h6) {
    margin-block: 0 0.5em;
    font-weight: 600;
    line-height: 1.2;
    text-wrap: balance;

    /* Experimental: Trim cap height spacing for precise layout - Chrome Canary */
    text-box-trim: trim-both;
    text-box-edge: cap alphabetic;
  }

  :where(p, ul, ol, dl, figure, blockquote) {
    margin-block: 0 1em;
  }

  :where(ul, ol):not([role="list"]) {
    padding-inline-start: 1.5em;
  }

  :where(li) {
    margin-block-end: 0.25em;
  }

  a {
    color: var(--color-accent);
    text-underline-offset: 0.15em;
    text-decoration-thickness: 0.05em;

    &:hover {
      /* Mix with black for hover state instead of separate variable */
      color: color-mix(in srgb, var(--color-accent) 85%, black);
    }

    &:active {
      color: color-mix(in srgb, var(--color-accent) 70%, black);
    }
  }

  abbr[title] {
    text-decoration: underline dotted;
    cursor: help;
    text-decoration-skip-ink: none;
  }

  :where(code, kbd, samp) {
    font-family: var(--font-mono);
    font-size: 0.9em;
    background: color-mix(in srgb, currentColor 6%, transparent);
    padding: 0.125em 0.25em;
    border-radius: 0.25rem;
    border: 1px solid color-mix(in srgb, currentColor 8%, transparent);
  }

  kbd {
    box-shadow: 0 1px 0 var(--color-border);
    font-size: 0.85em;
  }

  pre {
    font-family: var(--font-mono);
    font-size: 0.875em;
    overflow-x: auto;
    padding: var(--space-md);
    background: var(--color-surface);
    border: 1px solid var(--color-border);
    border-radius: 0.5rem;
    white-space: pre;
    word-wrap: normal;

    :where(code) {
      background: transparent;
      border: 0;
      padding: 0;
      font-size: inherit;
    }
  }

  hr {
    margin-block: var(--space-lg);
    border: 0;
    border-block-start: 1px solid var(--color-border);
    opacity: 0.5;
  }

  blockquote {
    margin-block: var(--space-lg);
    padding-inline: var(--space-md);
    border-inline-start: 4px solid var(--color-accent);
    color: var(--color-muted);
    font-style: italic;
  }

  mark {
    padding: 0.125em 0.25em;
    background-color: #fff3cd; /* Keeps semantic yellow but respects color-scheme */
    color: light-dark(inherit, #000); /* Ensure contrast in dark mode */
    border-radius: 0.125rem;
  }

  small {
    font-size: 0.875em;
  }

  sup,
  sub {
    font-size: 0.75em;
    line-height: 0;
    position: relative;
    vertical-align: baseline;
  }
  sup {
    top: -0.5em;
  }
  sub {
    bottom: -0.25em;
  }
}

/* =================================================================
   LAYER: FORMS (Modern and experimental features)
   ================================================================= */
@layer forms {
  :where(input, textarea, select) {
    display: block;
    inline-size: 100%;
    padding: var(--space-xs) var(--space-sm);
    border: 1px solid var(--color-border);
    border-radius: 0.375rem;
    background-color: var(--color-surface);
    transition: border-color 0.15s ease;
  }

  :where(input:focus, textarea:focus, select:focus) {
    outline: none;
    border-color: var(--color-accent);
    box-shadow: 0 0 0 3px
      color-mix(in srgb, var(--color-accent) 20%, transparent);
  }

  /* Chrome 123+: Auto-resizing textarea based on content */
  textarea {
    field-sizing: content;
    min-block-size: 3rem;
    max-block-size: 60dvb;
  }

  /* Native checkbox/radio styling via accent-color */
  :where(input[type="checkbox"], input[type="radio"]) {
    display: inline-block;
    inline-size: 1.125rem;
    block-size: 1.125rem;
    margin-inline-end: 0.5rem;
    vertical-align: middle;
    -webkit-appearance: auto;
    appearance: auto;
    accent-color: var(--color-accent);
    cursor: pointer;
  }

  :where(input[type="range"]) {
    -webkit-appearance: auto;
    appearance: auto;
    block-size: 0.5rem;
    padding: 0;
    background: var(--color-border);
    border-radius: 99px;
    accent-color: var(--color-accent);
    cursor: pointer;
  }

  label {
    display: block;
    margin-block-end: 0.25rem;
    font-size: 0.875rem;
    font-weight: 500;
    cursor: pointer;
  }

  /* Better validation states than :invalid/:valid */
  :where(input, textarea, select):user-invalid {
    border-color: #dc3545;

    &:focus {
      box-shadow: 0 0 0 3px color-mix(in srgb, #dc3545 20%, transparent);
    }
  }

  :where(input, textarea, select):user-valid {
    border-color: #198754;
  }

  :where(button, [type="submit"], [type="button"], [type="reset"]) {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 0.5ch;
    padding: var(--space-xs) var(--space-md);
    border: 1px solid transparent;
    border-radius: 0.375rem;
    background: var(--color-accent);
    color: light-dark(#fff, #000); /* Auto contrast text */
    font-weight: 500;
    line-height: 1.25;
    transition:
      filter 0.15s ease,
      scale 0.1s ease;

    &:hover {
      filter: brightness(1.1);
    }

    &:active {
      scale: 0.98;
    }
  }

  :where(button).outline,
  :where([type="button"]).outline {
    background: transparent;
    border-color: var(--color-border);
    color: var(--color-fg);

    &:hover {
      background: color-mix(in srgb, var(--color-fg) 5%, transparent);
    }
  }

  fieldset {
    margin-block-end: var(--space-md);
    padding: var(--space-md);
    border: 1px solid var(--color-border);
    border-radius: 0.5rem;
  }

  legend {
    padding-inline: var(--space-xs);
    font-weight: 600;
  }

  :where(input, button, select, textarea):disabled {
    opacity: 0.5;
    cursor: not-allowed;
  }

  ::placeholder {
    color: var(--color-muted);
    opacity: 1;
  }

  /* Remove native calendar picker icon where inappropriate */
  ::-webkit-calendar-picker-indicator {
    opacity: 0.6;
    cursor: pointer;
  }
}

/* =================================================================
   LAYER: COMPONENTS
   ================================================================= */
@layer components {
  details {
    border: 1px solid var(--color-border);
    border-radius: 0.5rem;
    padding: var(--space-sm);

    summary {
      cursor: pointer;
      font-weight: 500;
      user-select: none;
      margin: calc(var(--space-sm) * -1);
      padding: var(--space-sm);
      border-radius: 0.375rem;

      &:hover {
        background: color-mix(in srgb, currentColor 3%, transparent);
      }
    }
  }

  /* Experimental: Target the details content box directly - Canary */
  ::details-content {
    padding-block-start: var(--space-md);
    block-size: 0;
    overflow: hidden;
    transition:
      block-size 0.3s allow-discrete,
      content-visibility 0.3s allow-discrete;
  }

  details[open]::details-content {
    block-size: auto;
  }

  table {
    inline-size: 100%;
    border-collapse: collapse;
    caption-side: bottom;
    text-align: start;
    font-variant-numeric: tabular-nums;
  }

  th,
  td {
    padding: var(--space-sm);
    border-block-end: 1px solid var(--color-border);
    text-align: start;
  }

  th {
    font-weight: 600;
    background: color-mix(in srgb, var(--color-fg) 3%, transparent);
  }

  caption {
    padding-block: var(--space-sm);
    color: var(--color-muted);
    font-size: 0.875rem;
  }

  /* Hide elements with hidden attribute properly */
  [hidden] {
    display: none !important;
  }

  /* View Transitions API enabled by default */
  @view-transition {
    navigation: auto;
  }
}

/* =================================================================
   REDUCED MOTION
   ================================================================= */
@media (prefers-reduced-motion: reduce) {
  *,
  *::before,
  *::after {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
    scroll-behavior: auto !important;
  }
}
